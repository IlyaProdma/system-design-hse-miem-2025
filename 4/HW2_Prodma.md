## Домашка 2: Интеграции

1. Взять ФТ и НФТ из HW_1
2. Подумать какие сервисы будут и какие интеграции между ними лучше сделать
3. Выбрать способ взаимодействия между сервисами, написать обоснование
4. Сделать верхнеуровневую схему HLD: описать клиента, сервисы, интеграции

---
[ФТ и НФТ из HW_1](https://github.com/nikolaysavelev/system-design-hse-miem-2025/pull/32/files)

## Клиенты
- Пользователи
- Операторы копицентра (далее также ОК)
- Операторы техподдержки (далее также ОТП)


### Клиентское приложение
- Веб-клиент
- Мобильное приложение

### РМ с графическим интерфейсом для ОК
- Веб-приложение или настольное приложение

### РМ с графическим интерфейсом для ОТП
- Веб-приложение или настольное приложение


## Сервисы

### API-шлюз (API GW)
Единая входная точка для всех клиентских запросов и перенаправление на нужные службы, балансировка нагрузки.

### Аутентификация и авторизация (AUTH)
- Проверка подлинности пользователя при входе, регистрация новых пользователей
- Разделение прав на основе ролевой модели (клиент/оператор копицентра/техподдержка)
- Формирование токенов для совершения последующих запросов

### Служба документов (DOCS)
- Просмотр, импорт и создание документов в системе
- Работа с шаблонами документов

### Служба печати (PRINT)
Просмотр и создание заданий на печать

### Служба салонов печати (COPY)
- Просмотр информации о копицентрах
- Изменение состояния копицентра (открыто/закрыто/недоступность отдельных услуг)


## Интеграции

| Интеграция                  | Протокол                   | Обоснование                                             |
|-----------------------------|----------------------------|---------------------------------------------------------|
| Клиент + AUTH               | HTTP                       | Регистрация/вход в систему                              |
| Клиент + API GW             | HTTP                       | Входная точка для запросов                              |
| API GW + DOCS               | HTTP (REST)                | Работа с сущностями документов (CRUD)                   |
| API GW + PRINT              | HTTP (REST)                | Работа с сущностями заданий на печать (CRUD)            |
| API GW + COPY               | HTTP (REST)                | Работа с сущностями копицентров (CRUD)                  |
| AUTH + остальные сервисы    | JWT/OAuth2                 | Проверка подписи и роли                                 |
| PRINT + COPY                | HTTP (REST) (через API GW) | Проверка "совместимости" задания на печать и копицентра |

## Схема компонентов
```
                             +-----------------------+
                             |   Веб / Моб. клиент   |
                             +-----------------------+
                                         |
                                         v
                     +---------------------------------------+
                     |              API Gateway              |
                     +---------------------------------------+
                    /          |              |               \
                   /           |              |                \
                  v            v              v                 v
          +-----------+  +-----------+  +-----------+      +-----------+
          |   AUTH    |  |   DOCS    |  |   PRINT   | ---> |   COPY    |
          +-----------+  +-----------+  +-----------+      +-----------+
```

## Базы данных
1. **AUTH** — PostgreSQL
   Хранит пользователей, хэши паролей, роли. PostgreSQL хорошо подходит для реляционных данных и запросов по индексам.

2. **DOCS** — PostgreSQL + хранилище файлов (например, S3-совместимое)
   Метаданные документов и шаблонов - в базе. Сами файлы - в объектном хранилище. Это позволяет разгрузить БД.

3. **PRINT** — PostgreSQL
   Очередь заданий на печать, статусы, логи. Можно подключить индексирование по дате и ID пользователя. Подходит и для хранения истории.

4. **COPY** — PostgreSQL
   Список отделений, их статусы, конфигурация оборудования.

5. **Общее кеширование (опционально)** — Redis
   Быстрый доступ к шаблонам или статусам, если запросы повторяются часто. Поможет разгрузить API Gateway и DOCS при пиковых нагрузках.
