# Домашка 4: Дополнительные компоненты в HLD

## Обязательные компоненты (MUST)

| Компонент              | Обоснование                                                                                   | Реализация (опционально)                  |
|------------------------|-----------------------------------------------------------------------------------------------|-------------------------------------------|
| Load Balancer          | Нужен для распределения трафика между инстансами API Gateway и сервисов                     | Yandex Load Balancer, NGINX               |
| CDN                    | Быстрая доставка шаблонов и документов, особенно при расширении по регионам                 | Cloudflare + S3                           |
| Кэш                    | Снижает нагрузку на DOCS и PRINT при работе с часто запрашиваемыми данными                 | Redis Cluster                             |
| IdP                    | Централизованная аутентификация по ролям                                                     | Keycloak с OAuth2                         |
| WAF                    | Базовая защита от атак на API и интерфейсы                                                   | Cloudflare WAF                            |
| CI/CD                  | Автоматизация деплоя, снижение человеческого фактора                                         | GitLab CI, GitHub Actions                 |
| Обзервабилити          | Метрики, логи, трейсы для мониторинга и анализа                                              | Prometheus, Grafana, Loki, Tempo          |
| Резервное копирование  | Восстановление данных при сбоях, соответствие 152-ФЗ                                         | WAL-G для PostgreSQL, snapshots в S3      |

## Рекомендуемые компоненты (SHOULD)

| Компонент              | Обоснование                                                                                   | Реализация (опционально)                  |
|------------------------|-----------------------------------------------------------------------------------------------|-------------------------------------------|
| Service Mesh           | Управление связями между микросервисами                                                       | Istio, Linkerd                            |
| GeoDNS                 | Направление пользователей в ближайший региональный кластер                                   | Yandex DNS                                |
| Feature Flags          | Плавный rollout фич, быстрое отключение                                                       | LaunchDarkly, Unleash                     |
| API Gateway (расширенный) | Расширенные возможности: rate limiting, версии, протоколы                                  | Tyk, Kong                                 |
| Notification-сервис    | Уведомления о статусе печати, событиях в системе                                              | Kafka + email/app push                    |
| Rate limiting          | Защита от перегрузки API                                                                      | Через API GW или отдельный модуль         |

## Обоснование

1. MUST-компоненты критичны для отказоустойчивости, безопасности и базового уровня DevOps-культуры.
2. SHOULD-компоненты — логичное продолжение при масштабировании: управляемость, скорость отката и улучшение пользовательского опыта.
3. Всё вписывается в архитектуру, описанную в HW2 и HW3: микросервисы, API Gateway, PostgreSQL, Redis.
4. Notification-сервис может быть отдельным асинхронным сервисом, подписанным на события из PRINT и COPY.
5. IdP — обязательно, если в системе есть несколько ролей (клиент, оператор, поддержка), чтобы всё было централизованно и прозрачно.

## Включение в архитектуру

Дополнительные компоненты встраиваются в HLD следующим образом:

- Load Balancer — перед API Gateway и между сервисами при масштабировании.
- CDN — подключается к S3 (шаблоны, файлы документов).
- Redis-кеш — между API Gateway и сервисами DOCS/PRINT/COPY.
- IdP — общая точка входа в AUTH, передаёт токены в API Gateway.
- CI/CD, WAF, обзервабилити — обвязка всего кластера.

## Архитектурная схема
![диаграмма](https://github.com/IlyaProdma/system-design-hse-miem-2025/blob/a1fb22d7116a33403768b2bb8e6584034b54ad4f/HLD_HW4.drawio.png)
